<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AXYRA - Configuración</title>
    <link rel="stylesheet" href="../../static/axyra-styles.css" />
    <link rel="stylesheet" href="../../static/advanced-features.css" />
    <link rel="stylesheet" href="../../static/2fa-styles.css" />
    <link rel="stylesheet" href="../../static/responsive-styles.css" />
    <link rel="stylesheet" href="../../static/modal-fixes.css" />
    <link rel="stylesheet" href="config-styles.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Header Compartido AXYRA -->
    <script src="../../static/include-header.js"></script>

    <!-- Sistema Unificado de Autenticación AXYRA -->
    <script src="../../static/unified-auth-system.js"></script>

    <!-- Sistema de Roles y Permisos AXYRA -->
    <script src="../../static/roles-config.js"></script>

    <!-- Sistema de Notificaciones Push AXYRA -->
    <script src="../../static/notifications-system.js"></script>

    <!-- Sistema de Backup AXYRA -->
    <script src="../../static/backup-system.js"></script>

    <!-- Sistema 2FA AXYRA -->
    <script src="../../static/2fa-system.js"></script>

    <!-- Sistema de Timeout de Sesiones -->
    <script src="../../static/session-timeout.js"></script>

    <!-- Sistema de Configuración AXYRA -->
    <script src="config.js"></script>
  </head>
  <body>
    <!-- Header Compartido AXYRA - Se insertará automáticamente -->

    <!-- Main Content -->
    <main class="axyra-main-content">
      <div class="axyra-config-container">
        <h1 class="axyra-config-title">Configuración del Sistema</h1>
        <p class="axyra-config-subtitle">Gestiona la configuración de tu empresa y la seguridad del sistema</p>

        <!-- Dashboard de Métricas del Sistema -->
        <div class="axyra-system-dashboard">
          <div class="axyra-system-header">
            <h3>📊 Dashboard de Métricas del Sistema</h3>
            <p>Monitoreo en tiempo real del rendimiento y estado del sistema</p>
          </div>
          
          <div class="axyra-system-grid">
            <!-- Métricas de Usuarios -->
            <div class="axyra-system-card">
              <div class="axyra-system-card-header">
                <h4>👥 Usuarios del Sistema</h4>
                <div class="axyra-system-controls">
                  <select id="userMetricsPeriod" onchange="actualizarMetricasUsuarios()">
                    <option value="today">Hoy</option>
                    <option value="week" selected>Esta Semana</option>
                    <option value="month">Este Mes</option>
                  </select>
                </div>
              </div>
              <div class="axyra-system-chart">
                <canvas id="usuariosChart"></canvas>
              </div>
            </div>

            <!-- Métricas de Rendimiento -->
            <div class="axyra-system-card">
              <div class="axyra-system-card-header">
                <h4>⚡ Rendimiento del Sistema</h4>
                <p>Monitoreo de recursos y eficiencia</p>
              </div>
              <div class="axyra-system-chart">
                <canvas id="rendimientoChart"></canvas>
              </div>
            </div>

            <!-- Métricas de Seguridad -->
            <div class="axyra-system-card">
              <div class="axyra-system-card-header">
                <h4>🔒 Eventos de Seguridad</h4>
                <p>Actividad y alertas del sistema</p>
              </div>
              <div class="axyra-system-chart">
                <canvas id="seguridadChart"></canvas>
              </div>
            </div>

            <!-- KPIs del Sistema -->
            <div class="axyra-system-card">
              <div class="axyra-system-card-header">
                <h4>🎯 KPIs del Sistema</h4>
                <p>Indicadores clave de rendimiento</p>
              </div>
              <div class="axyra-system-metrics">
                <div class="axyra-kpi-item">
                  <div class="axyra-kpi-value" id="uptimeSistema">99.9%</div>
                  <div class="axyra-kpi-label">Uptime</div>
                </div>
                <div class="axyra-kpi-item">
                  <div class="axyra-kpi-value" id="usuariosActivos">0</div>
                  <div class="axyra-kpi-label">Usuarios Activos</div>
                </div>
                <div class="axyra-kpi-item">
                  <div class="axyra-kpi-value" id="alertasSeguridad">0</div>
                  <div class="axyra-kpi-label">Alertas</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Seguridad y Configuración -->
        <div class="axyra-security-section">
          <h2 class="axyra-section-title">Seguridad y Configuración</h2>
          <div class="axyra-security-grid">
            <!-- 2FA Status -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-shield-alt"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Autenticación de Dos Factores (2FA)</h4>
                <p>Protege tu cuenta con una capa adicional de seguridad</p>
                <div class="axyra-2fa-status" id="2faStatus">
                  <span class="axyra-2fa-label">Estado:</span>
                  <span class="axyra-2fa-value" id="2faStatusValue">No configurado</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="setup2FA()">
                    <i class="fas fa-cog"></i> Configurar 2FA
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="test2FA()">
                    <i class="fas fa-test-tube"></i> Probar
                  </button>
                </div>
              </div>
            </div>

            <!-- Session Timeout -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-clock"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Timeout de Sesión</h4>
                <p>Configura el tiempo de inactividad antes del cierre automático</p>
                <div class="axyra-session-info" id="sessionInfo">
                  <span class="axyra-session-label">Tiempo restante:</span>
                  <span class="axyra-session-time" id="sessionTime">--:--</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="resetSessionTimeout()">
                    <i class="fas fa-refresh"></i> Renovar Sesión
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureSessionTimeout()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>

            <!-- Responsive Design -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-mobile-alt"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Diseño Responsivo</h4>
                <p>Estado del sistema de adaptación a diferentes dispositivos</p>
                <div class="axyra-responsive-info" id="responsiveInfo">
                  <span class="axyra-responsive-label">Estado:</span>
                  <span class="axyra-responsive-status" id="responsiveStatus">Activo</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="testResponsive()">
                    <i class="fas fa-eye"></i> Probar Responsive
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureResponsive()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>

            <!-- Backup System -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-database"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Sistema de Backup</h4>
                <p>Configuración automática de respaldos del sistema</p>
                <div class="axyra-backup-info" id="backupInfo">
                  <span class="axyra-backup-label">Último backup:</span>
                  <span class="axyra-backup-time" id="lastBackupTime">Nunca</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="createBackup()">
                    <i class="fas fa-download"></i> Crear Backup
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureBackup()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Gestión Avanzada de Usuarios -->
        <div class="axyra-users-section">
          <h2 class="axyra-section-title">👥 Gestión Avanzada de Usuarios</h2>
          <p class="axyra-section-subtitle">Administra usuarios, roles y permisos del sistema</p>
          
          <div class="axyra-users-grid">
            <!-- Lista de Usuarios -->
            <div class="axyra-users-card">
              <div class="axyra-users-card-header">
                <h4>Usuarios del Sistema</h4>
                <button class="axyra-btn axyra-btn-primary" onclick="agregarNuevoUsuario()">
                  <i class="fas fa-plus"></i> Nuevo Usuario
                </button>
              </div>
              <div class="axyra-users-list" id="usuariosList">
                <!-- Los usuarios se cargarán dinámicamente -->
              </div>
            </div>

            <!-- Gestión de Roles -->
            <div class="axyra-users-card">
              <div class="axyra-users-card-header">
                <h4>Roles y Permisos</h4>
                <button class="axyra-btn axyra-btn-secondary" onclick="editarRoles()">
                  <i class="fas fa-edit"></i> Editar
                </button>
              </div>
              <div class="axyra-roles-list" id="rolesList">
                <!-- Los roles se cargarán dinámicamente -->
              </div>
            </div>
          </div>
        </div>

        <!-- Personalización y Temas -->
        <div class="axyra-theme-section">
          <h2 class="axyra-section-title">🎨 Personalización y Temas</h2>
          <p class="axyra-section-subtitle">Personaliza la apariencia y branding del sistema</p>
          
          <div class="axyra-theme-grid">
            <!-- Selector de Temas -->
            <div class="axyra-theme-card">
              <h4>Seleccionar Tema</h4>
              <div class="axyra-theme-selector">
                <div class="axyra-theme-option" data-theme="default">
                  <div class="axyra-theme-preview axyra-theme-default"></div>
                  <span>Default</span>
                </div>
                <div class="axyra-theme-option" data-theme="dark">
                  <div class="axyra-theme-preview axyra-theme-dark"></div>
                  <span>Dark</span>
                </div>
                <div class="axyra-theme-option" data-theme="corporate">
                  <div class="axyra-theme-preview axyra-theme-corporate"></div>
                  <span>Corporate</span>
                </div>
              </div>
            </div>

            <!-- Personalización de Colores -->
            <div class="axyra-theme-card">
              <h4>Colores Personalizados</h4>
              <div class="axyra-color-picker">
                <div class="axyra-color-item">
                  <label>Color Primario:</label>
                  <input type="color" id="primaryColor" value="#667eea" onchange="cambiarColorPrimario(this.value)">
                </div>
                <div class="axyra-color-item">
                  <label>Color Secundario:</label>
                  <input type="color" id="secondaryColor" value="#764ba2" onchange="cambiarColorSecundario(this.value)">
                </div>
                <div class="axyra-color-item">
                  <label>Color de Acento:</label>
                  <input type="color" id="accentColor" value="#f59e0b" onchange="cambiarColorAcento(this.value)">
                </div>
              </div>
            </div>
          </div>
        </div>
              </div>
              <div class="axyra-security-content">
                <h4>Sistema de Respaldo</h4>
                <p>Gestiona respaldos automáticos y manuales del sistema</p>
                <div class="axyra-backup-info" id="backupInfo">
                  <span class="axyra-backup-label">Último respaldo:</span>
                  <span class="axyra-backup-date" id="lastBackupDate">Nunca</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="performBackup()">
                    <i class="fas fa-download"></i> Realizar Respaldo
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureBackup()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>

            <!-- Notifications -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-bell"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Sistema de Notificaciones</h4>
                <p>Configura las notificaciones del sistema y su frecuencia</p>
                <div class="axyra-notifications-info" id="notificationsInfo">
                  <span class="axyra-notifications-label">Frecuencia:</span>
                  <span class="axyra-notifications-frequency" id="notificationsFrequency">Cada 10 min</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="testNotifications()">
                    <i class="fas fa-bell"></i> Probar Notificación
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureNotifications()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>

            <!-- System Updates -->
            <div class="axyra-security-item">
              <div class="axyra-security-icon">
                <i class="fas fa-sync-alt"></i>
              </div>
              <div class="axyra-security-content">
                <h4>Actualizaciones del Sistema</h4>
                <p>Verifica y gestiona las actualizaciones disponibles</p>
                <div class="axyra-updates-info" id="updatesInfo">
                  <span class="axyra-updates-label">Versión actual:</span>
                  <span class="axyra-updates-version" id="currentVersion">1.0.0</span>
                </div>
                <div class="axyra-security-actions">
                  <button class="axyra-btn axyra-btn-primary" onclick="checkUpdates()">
                    <i class="fas fa-search"></i> Verificar Actualizaciones
                  </button>
                  <button class="axyra-btn axyra-btn-secondary" onclick="configureUpdates()">
                    <i class="fas fa-cog"></i> Configurar
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Configuración de Empresa -->
        <div class="axyra-company-section">
          <h2 class="axyra-section-title">Configuración de Empresa</h2>
          <div class="axyra-company-form">
            <div class="axyra-form-group">
              <label for="companyName">Nombre de la Empresa</label>
              <input
                type="text"
                id="companyName"
                class="axyra-form-input"
                placeholder="Ingresa el nombre de tu empresa"
              />
            </div>
            <div class="axyra-form-group">
              <label for="companyNIT">NIT</label>
              <input type="text" id="companyNIT" class="axyra-form-input" placeholder="Ingresa el NIT de la empresa" />
            </div>
            <div class="axyra-form-group">
              <label for="companyAddress">Dirección</label>
              <input
                type="text"
                id="companyAddress"
                class="axyra-form-input"
                placeholder="Ingresa la dirección de la empresa"
              />
            </div>
            <div class="axyra-form-group">
              <label for="companyPhone">Teléfono</label>
              <input
                type="tel"
                id="companyPhone"
                class="axyra-form-input"
                placeholder="Ingresa el teléfono de la empresa"
              />
            </div>
            <div class="axyra-form-group">
              <label for="companyEmail">Email</label>
              <input
                type="email"
                id="companyEmail"
                class="axyra-form-input"
                placeholder="Ingresa el email de la empresa"
              />
            </div>
            <div class="axyra-form-actions">
              <button class="axyra-btn axyra-btn-primary" onclick="saveCompanyConfig()">
                <i class="fas fa-save"></i> Guardar Configuración
              </button>
              <button class="axyra-btn axyra-btn-secondary" onclick="resetCompanyConfig()">
                <i class="fas fa-undo"></i> Restaurar Valores
              </button>
            </div>
          </div>
        </div>

        <!-- Configuración del Sistema -->
        <div class="axyra-system-section">
          <h2 class="axyra-section-title">Configuración del Sistema</h2>
          <div class="axyra-system-options">
            <div class="axyra-option-group">
              <h4>Preferencias Generales</h4>
              <div class="axyra-option-item">
                <label class="axyra-switch">
                  <input type="checkbox" id="autoSave" checked />
                  <span class="axyra-slider"></span>
                </label>
                <span class="axyra-option-label">Guardado automático</span>
              </div>
              <div class="axyra-option-item">
                <label class="axyra-switch">
                  <input type="checkbox" id="darkMode" />
                  <span class="axyra-slider"></span>
                </label>
                <span class="axyra-option-label">Modo oscuro</span>
              </div>
              <div class="axyra-option-item">
                <label class="axyra-switch">
                  <input type="checkbox" id="notifications" checked />
                  <span class="axyra-slider"></span>
                </label>
                <span class="axyra-option-label">Notificaciones push</span>
              </div>
            </div>

            <div class="axyra-option-group">
              <h4>Configuración de Sesión</h4>
              <div class="axyra-option-item">
                <label for="sessionTimeout">Timeout de sesión (minutos)</label>
                <select id="sessionTimeout" class="axyra-form-select">
                  <option value="15">15 minutos</option>
                  <option value="30" selected>30 minutos</option>
                  <option value="60">1 hora</option>
                  <option value="120">2 horas</option>
                </select>
              </div>
              <div class="axyra-option-item">
                <label for="maxLoginAttempts">Intentos máximos de login</label>
                <select id="maxLoginAttempts" class="axyra-form-select">
                  <option value="3">3 intentos</option>
                  <option value="5" selected>5 intentos</option>
                  <option value="10">10 intentos</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Scripts -->
    <script src="../../static/roles-config.js"></script>
    <script src="../../static/notifications-system.js"></script>
    <script src="../../static/session-timeout.js"></script>
    <script src="../../static/2fa-system.js"></script>
    <script src="../../static/backup-system.js"></script>

    <script src="config.js"></script>

    <!-- FUNCIONES AVANZADAS DE CONFIGURACIÓN - IMPLEMENTACIÓN COMPLETA -->
    <script>
      // Función para configurar empresa completa
      function configurarEmpresaCompleta() {
        try {
          console.log('🔄 Configurando empresa completa...');

          const configuracion = {
            empresa: {
              nombre: document.getElementById('companyName')?.value || 'VILLA VENECIA',
              nit: document.getElementById('companyNIT')?.value || '900123456-7',
              direccion: document.getElementById('companyAddress')?.value || 'Calle Principal #123',
              telefono: document.getElementById('companyPhone')?.value || '+57 300 123 4567',
              email: document.getElementById('companyEmail')?.value || 'contacto@villavenecia.com',
              logo: 'logo.png',
              industria: 'Restaurante y Eventos',
              regimen: 'Responsable de IVA',
              tipoEmpresa: 'Sociedad por Acciones Simplificada',
            },
            nómina: {
              salarioMinimo: 1300000,
              porcentajeCesantias: 8.33,
              porcentajePrima: 8.33,
              porcentajeInteresesCesantias: 12,
              porcentajeSalud: 4,
              porcentajePension: 4,
              porcentajeARL: 0.522,
              porcentajeCajaCompensacion: 4,
              porcentajeICBF: 3,
              porcentajeSENA: 2,
            },
            sistema: {
              autoSave: document.getElementById('autoSave')?.checked || true,
              darkMode: document.getElementById('darkMode')?.checked || false,
              notifications: document.getElementById('notifications')?.checked || true,
              sessionTimeout: parseInt(document.getElementById('sessionTimeout')?.value || '30'),
              maxLoginAttempts: parseInt(document.getElementById('maxLoginAttempts')?.value || '5'),
              backupAutomatico: true,
              backupFrecuencia: 'DIARIO',
              backupRetencion: 30,
            },
            seguridad: {
              passwordMinLength: 8,
              requireSpecialChars: true,
              requireNumbers: true,
              requireUppercase: true,
              sessionEncryption: true,
              auditLog: true,
              ipWhitelist: [],
              allowedDomains: [],
            },
            notificaciones: {
              email: true,
              push: true,
              sms: false,
              whatsapp: false,
              frecuencia: 'INMEDIATA',
              horarioInicio: '08:00',
              horarioFin: '18:00',
            },
          };

          // Guardar configuración
          localStorage.setItem('axyra_configuracion_completa', JSON.stringify(configuracion));

          // Aplicar configuración al sistema
          aplicarConfiguracionSistema(configuracion);

          console.log('✅ Configuración de empresa completada:', configuracion);
          mostrarNotificacion('✅ Configuración de empresa guardada correctamente', 'success');
        } catch (error) {
          console.error('❌ Error configurando empresa:', error);
          mostrarNotificacion('❌ Error: ' + error.message, 'error');
        }
      }

      // Función para aplicar configuración al sistema
      function aplicarConfiguracionSistema(configuracion) {
        try {
          console.log('🔄 Aplicando configuración al sistema...');

          // Aplicar configuración de sesión
          if (window.axyraSessionTimeout) {
            window.axyraSessionTimeout.setTimeout(configuracion.sistema.sessionTimeout * 60 * 1000);
          }

          // Aplicar configuración de notificaciones
          if (window.axyraNotificationSystem) {
            window.axyraNotificationSystem.updateConfig(configuracion.notificaciones);
          }

          // Aplicar configuración de seguridad
          if (window.axyraRolesConfig) {
            window.axyraRolesConfig.updateSecurityConfig(configuracion.seguridad);
          }

          // Aplicar modo oscuro
          if (configuracion.sistema.darkMode) {
            document.body.classList.add('axyra-dark-mode');
          } else {
            document.body.classList.remove('axyra-dark-mode');
          }

          // Aplicar configuración de backup
          if (window.axyraBackupSystem) {
            window.axyraBackupSystem.updateConfig(configuracion.sistema);
          }

          console.log('✅ Configuración aplicada al sistema correctamente');
        } catch (error) {
          console.error('❌ Error aplicando configuración:', error);
        }
      }

      // Función para gestión completa de usuarios y roles
      function gestionarUsuariosCompleta() {
        try {
          console.log('🔄 Abriendo gestión completa de usuarios...');

          // Obtener usuarios del sistema
          const usuarios = JSON.parse(localStorage.getItem('axyra_usuarios') || '[]');
          const roles = JSON.parse(localStorage.getItem('axyra_roles') || '[]');

          // Mostrar modal de gestión
          mostrarModalGestionUsuarios(usuarios, roles);
        } catch (error) {
          console.error('❌ Error abriendo gestión de usuarios:', error);
          mostrarNotificacion('❌ Error: ' + error.message, 'error');
        }
      }

      // Función para mostrar modal de gestión de usuarios
      function mostrarModalGestionUsuarios(usuarios, roles) {
        const modalHTML = `
          <div class="axyra-modal-overlay" id="modalGestionUsuarios">
            <div class="axyra-modal axyra-modal-large">
              <div class="axyra-modal-header">
                <h3>Gestión Completa de Usuarios y Roles</h3>
                <button onclick="cerrarModalGestionUsuarios()" class="axyra-modal-close">&times;</button>
              </div>
              <div class="axyra-modal-content">
                <div class="axyra-tabs">
                  <button class="axyra-tab-button active" onclick="cambiarTab('usuarios')">Usuarios</button>
                  <button class="axyra-tab-button" onclick="cambiarTab('roles')">Roles</button>
                  <button class="axyra-tab-button" onclick="cambiarTab('permisos')">Permisos</button>
                </div>
                
                <div id="tabUsuarios" class="axyra-tab-content active">
                  <div class="axyra-users-list">
                    ${usuarios
                      .map(
                        (usuario) => `
                      <div class="axyra-user-item">
                        <div class="axyra-user-info">
                          <h4>${usuario.nombre || usuario.email}</h4>
                          <span class="axyra-user-role">${usuario.rol || 'Sin rol'}</span>
                          <span class="axyra-user-status ${usuario.activo ? 'activo' : 'inactivo'}">
                            ${usuario.activo ? 'Activo' : 'Inactivo'}
                          </span>
                        </div>
                        <div class="axyra-user-actions">
                          <button onclick="editarUsuario('${
                            usuario.id
                          }')" class="axyra-btn axyra-btn-sm axyra-btn-primary">
                            <i class="fas fa-edit"></i>
                          </button>
                          <button onclick="cambiarEstadoUsuario('${
                            usuario.id
                          }')" class="axyra-btn axyra-btn-sm axyra-btn-${usuario.activo ? 'warning' : 'success'}">
                            <i class="fas fa-${usuario.activo ? 'pause' : 'play'}"></i>
                          </button>
                        </div>
                      </div>
                    `
                      )
                      .join('')}
                  </div>
                  <button onclick="agregarNuevoUsuario()" class="axyra-btn axyra-btn-success">
                    <i class="fas fa-plus"></i> Agregar Usuario
                  </button>
                </div>
                
                <div id="tabRoles" class="axyra-tab-content">
                  <div class="axyra-roles-list">
                    ${roles
                      .map(
                        (rol) => `
                      <div class="axyra-role-item">
                        <div class="axyra-role-info">
                          <h4>${rol.nombre}</h4>
                          <p>${rol.descripcion || 'Sin descripción'}</p>
                          <span class="axyra-role-users">${rol.usuarios || 0} usuarios</span>
                        </div>
                        <div class="axyra-role-actions">
                          <button onclick="editarRol('${rol.id}')" class="axyra-btn axyra-btn-sm axyra-btn-primary">
                            <i class="fas fa-edit"></i>
                          </button>
                          <button onclick="eliminarRol('${rol.id}')" class="axyra-btn axyra-btn-sm axyra-btn-danger">
                            <i class="fas fa-trash"></i>
                          </button>
                        </div>
                      </div>
                    `
                      )
                      .join('')}
                  </div>
                  <button onclick="agregarNuevoRol()" class="axyra-btn axyra-btn-success">
                    <i class="fas fa-plus"></i> Agregar Rol
                  </button>
                </div>
                
                <div id="tabPermisos" class="axyra-tab-content">
                  <div class="axyra-permissions-grid">
                    <div class="axyra-permission-section">
                      <h4>Módulos del Sistema</h4>
                      <div class="axyra-permission-item">
                        <span>Dashboard</span>
                        <label class="axyra-switch">
                          <input type="checkbox" checked disabled />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Empleados</span>
                        <label class="axyra-switch">
                          <input type="checkbox" checked />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Horas</span>
                        <label class="axyra-switch">
                          <input type="checkbox" checked />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Nómina</span>
                        <label class="axyra-switch">
                          <input type="checkbox" />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Cuadre de Caja</span>
                        <label class="axyra-switch">
                          <input type="checkbox" />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Inventario</span>
                        <label class="axyra-switch">
                          <input type="checkbox" />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                      <div class="axyra-permission-item">
                        <span>Configuración</span>
                        <label class="axyra-switch">
                          <input type="checkbox" />
                          <span class="axyra-slider"></span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="axyra-modal-footer">
                <button onclick="guardarCambiosUsuarios()" class="axyra-btn axyra-btn-primary">
                  <i class="fas fa-save"></i> Guardar Cambios
                </button>
                <button onclick="cerrarModalGestionUsuarios()" class="axyra-btn axyra-btn-secondary">
                  Cerrar
                </button>
              </div>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
      }

      // Función para cambiar tabs
      function cambiarTab(tabName) {
        // Ocultar todos los tabs
        document.querySelectorAll('.axyra-tab-content').forEach((tab) => {
          tab.classList.remove('active');
        });
        document.querySelectorAll('.axyra-tab-button').forEach((button) => {
          button.classList.remove('active');
        });

        // Mostrar tab seleccionado
        document.getElementById('tab' + tabName.charAt(0).toUpperCase() + tabName.slice(1)).classList.add('active');
        event.target.classList.add('active');
      }

      // Función para cerrar modal de gestión de usuarios
      function cerrarModalGestionUsuarios() {
        const modal = document.getElementById('modalGestionUsuarios');
        if (modal) {
          modal.remove();
        }
      }

      // Función para sistema de backup completo
      function sistemaBackupCompleto() {
        try {
          console.log('🔄 Iniciando sistema de backup completo...');

          if (window.axyraBackupSystem) {
            window.axyraBackupSystem.createBackup();
          } else {
            // Backup manual si no está disponible el sistema
            crearBackupManual();
          }
        } catch (error) {
          console.error('❌ Error en sistema de backup:', error);
          mostrarNotificacion('❌ Error: ' + error.message, 'error');
        }
      }

      // Función para crear backup manual
      function crearBackupManual() {
        try {
          console.log('🔄 Creando backup manual...');

          const backup = {
            fecha: new Date().toISOString(),
            version: '1.0.0',
            datos: {
              empleados: JSON.parse(localStorage.getItem('axyra_empleados') || '[]'),
              horas: JSON.parse(localStorage.getItem('axyra_horas') || '[]'),
              nominas: JSON.parse(localStorage.getItem('axyra_nominas') || '[]'),
              facturas: JSON.parse(localStorage.getItem('axyra_facturas') || '[]'),
              inventario: JSON.parse(localStorage.getItem('axyra_inventario') || '[]'),
              configuracion: JSON.parse(localStorage.getItem('axyra_configuracion_completa') || '{}'),
            },
            metadata: {
              totalRegistros: 0,
              tamañoAproximado: 0,
            },
          };

          // Calcular metadata
          Object.values(backup.datos).forEach((datos) => {
            if (Array.isArray(datos)) {
              backup.metadata.totalRegistros += datos.length;
            }
          });

          backup.metadata.tamañoAproximado = JSON.stringify(backup).length;

          // Guardar backup
          const backups = JSON.parse(localStorage.getItem('axyra_backups') || '[]');
          backups.push(backup);
          localStorage.setItem('axyra_backups', JSON.stringify(backups));

          // Descargar backup
          const dataStr = JSON.stringify(backup, null, 2);
          const dataBlob = new Blob([dataStr], { type: 'application/json' });
          const url = URL.createObjectURL(dataBlob);
          const link = document.createElement('a');
          link.href = url;
          link.download = `AXYRA_Backup_${new Date().toISOString().split('T')[0]}.json`;
          link.click();
          URL.revokeObjectURL(url);

          console.log('✅ Backup manual creado:', backup);
          mostrarNotificacion('✅ Backup manual creado correctamente', 'success');
        } catch (error) {
          console.error('❌ Error creando backup manual:', error);
          mostrarNotificacion('❌ Error: ' + error.message, 'error');
        }
      }

      // Función para restaurar backup
      function restaurarBackup() {
        try {
          console.log('🔄 Restaurando backup...');

          const input = document.createElement('input');
          input.type = 'file';
          input.accept = '.json';

          input.onchange = function (e) {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onload = function (e) {
                try {
                  const backup = JSON.parse(e.target.result);

                  // Validar backup
                  if (!backup.datos || !backup.fecha) {
                    throw new Error('Archivo de backup inválido');
                  }

                  // Restaurar datos
                  Object.entries(backup.datos).forEach(([key, value]) => {
                    localStorage.setItem('axyra_' + key, JSON.stringify(value));
                  });

                  console.log('✅ Backup restaurado correctamente:', backup);
                  mostrarNotificacion('✅ Backup restaurado correctamente', 'success');

                  // Recargar página para aplicar cambios
                  setTimeout(() => {
                    window.location.reload();
                  }, 2000);
                } catch (error) {
                  console.error('❌ Error restaurando backup:', error);
                  mostrarNotificacion('❌ Error: ' + error.message, 'error');
                }
              };
              reader.readAsText(file);
            }
          };

          input.click();
        } catch (error) {
          console.error('❌ Error restaurando backup:', error);
          mostrarNotificacion('❌ Error: ' + error.message, 'error');
        }
      }

      // Función para configuración de áreas de trabajo
      function configurarAreasTrabajo() {
        try {
          console.log('🔄 Configurando áreas de trabajo...');

          if (window.axyraWorkAreasConfig) {
            window.axyraWorkAreasConfig.openConfiguration();
          } else {
            // Configuración manual si no está disponible
            mostrarModalAreasTrabajo();
          }
        } catch (error) {
          console.error('❌ Error configurando áreas de trabajo:', error);
          mostrarNotificacion('❌ Error: ' + error.message, 'error');
        }
      }

      // Función para mostrar modal de áreas de trabajo
      function mostrarModalAreasTrabajo() {
        const modalHTML = `
          <div class="axyra-modal-overlay" id="modalAreasTrabajo">
            <div class="axyra-modal">
              <div class="axyra-modal-header">
                <h3>Configuración de Áreas de Trabajo</h3>
                <button onclick="cerrarModalAreasTrabajo()" class="axyra-modal-close">&times;</button>
              </div>
              <div class="axyra-modal-content">
                <div class="axyra-areas-list">
                  <div class="axyra-area-item">
                    <h4>Cocina</h4>
                    <p>Área principal de preparación de alimentos</p>
                    <div class="axyra-area-config">
                      <label>Capacidad máxima:</label>
                      <input type="number" value="15" min="1" max="50" />
                      <label>Horario:</label>
                      <select>
                        <option>6:00 AM - 10:00 PM</option>
                        <option>24/7</option>
                        <option>Personalizado</option>
                      </select>
                    </div>
                  </div>
                  
                  <div class="axyra-area-item">
                    <h4>Salón Principal</h4>
                    <p>Área de eventos y restaurante</p>
                    <div class="axyra-area-config">
                      <label>Capacidad máxima:</label>
                      <input type="number" value="200" min="1" max="1000" />
                      <label>Horario:</label>
                      <select>
                        <option>11:00 AM - 11:00 PM</option>
                        <option>24/7</option>
                        <option>Personalizado</option>
                      </select>
                    </div>
                  </div>
                  
                  <div class="axyra-area-item">
                    <h4>Bar</h4>
                    <p>Área de bebidas y coctelería</p>
                    <div class="axyra-area-config">
                      <label>Capacidad máxima:</label>
                      <input type="number" value="50" min="1" max="200" />
                      <label>Horario:</label>
                      <select>
                        <option>5:00 PM - 2:00 AM</option>
                        <option>24/7</option>
                        <option>Personalizado</option>
                      </select>
                    </div>
                  </div>
                </div>
              </div>
              <div class="axyra-modal-footer">
                <button onclick="guardarAreasTrabajo()" class="axyra-btn axyra-btn-primary">
                  <i class="fas fa-save"></i> Guardar Configuración
                </button>
                <button onclick="cerrarModalAreasTrabajo()" class="axyra-btn axyra-btn-secondary">
                  Cerrar
                </button>
              </div>
            </div>
          </div>
        `;

        document.body.insertAdjacentHTML('beforeend', modalHTML);
      }

      // Función para cerrar modal de áreas de trabajo
      function cerrarModalAreasTrabajo() {
        const modal = document.getElementById('modalAreasTrabajo');
        if (modal) {
          modal.remove();
        }
      }

      // Función para guardar áreas de trabajo
      function guardarAreasTrabajo() {
        try {
          // Implementar guardado de áreas de trabajo
          mostrarNotificacion('✅ Configuración de áreas de trabajo guardada', 'success');
          cerrarModalAreasTrabajo();
        } catch (error) {
          console.error('❌ Error guardando áreas de trabajo:', error);
        }
      }

      // Agregar funciones al scope global
      window.configurarEmpresaCompleta = configurarEmpresaCompleta;
      window.gestionarUsuariosCompleta = gestionarUsuariosCompleta;
      window.sistemaBackupCompleto = sistemaBackupCompleto;
      window.restaurarBackup = restaurarBackup;
      window.configurarAreasTrabajo = configurarAreasTrabajo;
      window.cambiarTab = cambiarTab;
      window.cerrarModalGestionUsuarios = cerrarModalGestionUsuarios;
      window.cerrarModalAreasTrabajo = cerrarModalAreasTrabajo;
      window.guardarAreasTrabajo = guardarAreasTrabajo;
    </script>

    <style>
      /* Estilos para Dashboard del Sistema */
      .axyra-system-dashboard {
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        border-radius: 20px;
        padding: 30px;
        margin: 30px 0;
        border: 1px solid #cbd5e1;
      }

      .axyra-system-header {
        text-align: center;
        margin-bottom: 30px;
      }

      .axyra-system-header h3 {
        color: #1e3a8a;
        font-size: 1.8rem;
        margin: 0 0 10px 0;
        font-weight: 700;
      }

      .axyra-system-header p {
        color: #475569;
        font-size: 1.1rem;
        margin: 0;
      }

      .axyra-system-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 25px;
      }

      .axyra-system-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
        transition: all 0.3s ease;
      }

      .axyra-system-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0,0,0,0.15);
      }

      .axyra-system-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f1f5f9;
      }

      .axyra-system-card-header h4 {
        color: #1e3a8a;
        margin: 0;
        font-size: 1.2rem;
        font-weight: 600;
      }

      .axyra-system-card-header p {
        color: #475569;
        margin: 5px 0 0 0;
        font-size: 0.9rem;
      }

      .axyra-system-controls select {
        padding: 8px 12px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        background: #f8fafc;
        color: #374151;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .axyra-system-controls select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .axyra-system-chart {
        height: 250px;
        position: relative;
      }

      .axyra-system-metrics {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 20px;
      }

      .axyra-kpi-item {
        text-align: center;
        padding: 20px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        color: white;
      }

      .axyra-kpi-value {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 8px;
      }

      .axyra-kpi-label {
        font-size: 0.9rem;
        opacity: 0.9;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      /* Estilos para Gestión de Usuarios */
      .axyra-users-section {
        margin: 40px 0;
      }

      .axyra-section-title {
        color: #1e3a8a;
        font-size: 1.6rem;
        margin: 0 0 10px 0;
        font-weight: 600;
      }

      .axyra-section-subtitle {
        color: #475569;
        font-size: 1rem;
        margin: 0 0 25px 0;
      }

      .axyra-users-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 25px;
      }

      .axyra-users-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
      }

      .axyra-users-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f1f5f9;
      }

      .axyra-users-card-header h4 {
        color: #1e3a8a;
        margin: 0;
        font-size: 1.2rem;
        font-weight: 600;
      }

      /* Estilos para Personalización de Temas */
      .axyra-theme-section {
        margin: 40px 0;
      }

      .axyra-theme-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
        gap: 25px;
      }

      .axyra-theme-card {
        background: white;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        border: 1px solid #e2e8f0;
      }

      .axyra-theme-card h4 {
        color: #1e3a8a;
        margin: 0 0 20px 0;
        font-size: 1.2rem;
        font-weight: 600;
      }

      .axyra-theme-selector {
        display: flex;
        gap: 15px;
        margin-bottom: 20px;
      }

      .axyra-theme-option {
        text-align: center;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .axyra-theme-option:hover {
        transform: translateY(-2px);
      }

      .axyra-theme-preview {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        margin: 0 auto 10px;
        border: 3px solid transparent;
        transition: all 0.3s ease;
      }

      .axyra-theme-option.active .axyra-theme-preview {
        border-color: #667eea;
      }

      .axyra-theme-default {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .axyra-theme-dark {
        background: linear-gradient(135deg, #1f2937 0%, #374151 100%);
      }

      .axyra-theme-corporate {
        background: linear-gradient(135deg, #059669 0%, #10b981 100%);
      }

      .axyra-color-picker {
        display: grid;
        gap: 15px;
      }

      .axyra-color-item {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .axyra-color-item label {
        color: #374151;
        font-weight: 500;
        min-width: 120px;
      }

      .axyra-color-item input[type="color"] {
        width: 50px;
        height: 40px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
      }

      /* Responsive */
      @media (max-width: 768px) {
        .axyra-system-grid,
        .axyra-users-grid,
        .axyra-theme-grid {
          grid-template-columns: 1fr;
        }
        
        .axyra-system-metrics {
          grid-template-columns: 1fr;
        }
        
        .axyra-theme-selector {
          flex-direction: column;
          align-items: center;
        }
      }
    </style>

    <!-- Script de Inicialización -->
    <script>
      // Esperar a que todos los scripts se carguen
      document.addEventListener('DOMContentLoaded', function() {
        console.log('🚀 DOM cargado, inicializando configuración...');
        
        // Esperar un poco más para asegurar que todos los sistemas estén listos
        setTimeout(() => {
          try {
            // Inicializar configuración si está disponible
            if (window.axyraConfig) {
              console.log('✅ Sistema de configuración encontrado, inicializando...');
              window.axyraConfig.init();
            } else {
              console.log('⚠️ Sistema de configuración no disponible, usando fallback...');
              inicializarConfiguracionFallback();
            }

            // Cargar configuración de empresa
            cargarConfiguracionEmpresa();
            
            // Configurar eventos
            configurarEventos();
            
            console.log('✅ Configuración inicializada correctamente');
          } catch (error) {
            console.error('❌ Error inicializando configuración:', error);
          }
        }, 1000);
      });

      // Función de fallback para configuración
      function inicializarConfiguracionFallback() {
        console.log('🔄 Inicializando configuración de fallback...');
        
        // Configurar valores por defecto
        const configuracionDefault = {
          empresa: {
            nombre: 'VILLA VENECIA',
            nit: '900123456-7',
            direccion: 'Calle Principal #123',
            telefono: '+57 300 123 4567',
            email: 'contacto@villavenecia.com'
          },
          sistema: {
            autoSave: true,
            darkMode: false,
            notifications: true,
            sessionTimeout: 30,
            maxLoginAttempts: 5
          }
        };

        // Guardar configuración por defecto
        localStorage.setItem('axyra_configuracion_default', JSON.stringify(configuracionDefault));
        
        // Aplicar configuración
        aplicarConfiguracionDefault(configuracionDefault);
      }

      // Función para aplicar configuración por defecto
      function aplicarConfiguracionDefault(config) {
        try {
          // Aplicar configuración de empresa
          if (config.empresa) {
            Object.entries(config.empresa).forEach(([key, value]) => {
              const element = document.getElementById(key === 'nombre' ? 'companyName' : 
                                                   key === 'nit' ? 'companyNIT' : 
                                                   key === 'direccion' ? 'companyAddress' : 
                                                   key === 'telefono' ? 'companyPhone' : 
                                                   key === 'email' ? 'companyEmail' : null);
              if (element) {
                element.value = value;
              }
            });
          }

          // Aplicar configuración del sistema
          if (config.sistema) {
            if (document.getElementById('autoSave')) {
              document.getElementById('autoSave').checked = config.sistema.autoSave;
            }
            if (document.getElementById('darkMode')) {
              document.getElementById('darkMode').checked = config.sistema.darkMode;
            }
            if (document.getElementById('notifications')) {
              document.getElementById('notifications').checked = config.sistema.notifications;
            }
            if (document.getElementById('sessionTimeout')) {
              document.getElementById('sessionTimeout').value = config.sistema.sessionTimeout;
            }
            if (document.getElementById('maxLoginAttempts')) {
              document.getElementById('maxLoginAttempts').value = config.sistema.maxLoginAttempts;
            }
          }

          console.log('✅ Configuración por defecto aplicada');
        } catch (error) {
          console.error('❌ Error aplicando configuración por defecto:', error);
        }
      }

      // Función para cargar configuración de empresa
      function cargarConfiguracionEmpresa() {
        try {
          const configuracion = JSON.parse(localStorage.getItem('axyra_configuracion_completa') || '{}');
          
          if (configuracion.empresa) {
            Object.entries(configuracion.empresa).forEach(([key, value]) => {
              const element = document.getElementById(key === 'nombre' ? 'companyName' : 
                                                   key === 'nit' ? 'companyNIT' : 
                                                   key === 'direccion' ? 'companyAddress' : 
                                                   key === 'telefono' ? 'companyPhone' : 
                                                   key === 'email' ? 'companyEmail' : null);
              if (element) {
                element.value = value;
              }
            });
          }
        } catch (error) {
          console.error('❌ Error cargando configuración de empresa:', error);
        }
      }

      // Función para configurar eventos
      function configurarEventos() {
        try {
          // Eventos para cambio de colores
          const colorInputs = document.querySelectorAll('input[type="color"]');
          colorInputs.forEach(input => {
            input.addEventListener('change', function() {
              const color = this.value;
              const property = this.id === 'primaryColor' ? '--axyra-primary' : 
                             this.id === 'secondaryColor' ? '--axyra-secondary' : 
                             this.id === 'accentColor' ? '--axyra-accent' : null;
              
              if (property) {
                document.documentElement.style.setProperty(property, color);
                console.log(`🎨 Color ${property} cambiado a: ${color}`);
              }
            });
          });

          // Eventos para cambio de tema
          const themeOptions = document.querySelectorAll('.axyra-theme-option');
          themeOptions.forEach(option => {
            option.addEventListener('click', function() {
              const theme = this.dataset.theme;
              cambiarTema(theme);
              
              // Actualizar estado activo
              themeOptions.forEach(opt => opt.classList.remove('active'));
              this.classList.add('active');
            });
          });

          console.log('✅ Eventos configurados correctamente');
        } catch (error) {
          console.error('❌ Error configurando eventos:', error);
        }
      }

      // Función para cambiar tema
      function cambiarTema(theme) {
        try {
          // Remover clases de tema anteriores
          document.body.classList.remove('axyra-theme-default', 'axyra-theme-dark', 'axyra-theme-corporate');
          
          // Agregar nueva clase de tema
          document.body.classList.add(`axyra-theme-${theme}`);
          
          // Guardar preferencia
          localStorage.setItem('axyra_tema', theme);
          
          console.log(`🎨 Tema cambiado a: ${theme}`);
        } catch (error) {
          console.error('❌ Error cambiando tema:', error);
        }
      }

      // Función para mostrar notificaciones
      function mostrarNotificacion(mensaje, tipo = 'info') {
        try {
          if (window.axyraNotificationSystem) {
            window.axyraNotificationSystem.show(mensaje, tipo);
          } else {
            // Fallback a alert si no hay sistema de notificaciones
            alert(mensaje);
          }
        } catch (error) {
          console.error('❌ Error mostrando notificación:', error);
          alert(mensaje);
        }
      }

      // Función para crear backup
      function createBackup() {
        try {
          if (window.axyraBackupSystem) {
            window.axyraBackupSystem.createBackup();
          } else {
            // Fallback manual
            crearBackupManual();
          }
        } catch (error) {
          console.error('❌ Error creando backup:', error);
          mostrarNotificacion('❌ Error creando backup: ' + error.message, 'error');
        }
      }

      // Función para agregar nuevo usuario
      function agregarNuevoUsuario() {
        try {
          mostrarNotificacion('👤 Función de agregar usuario disponible en próximas versiones', 'info');
        } catch (error) {
          console.error('❌ Error agregando usuario:', error);
        }
      }

      // Función para editar roles
      function editarRoles() {
        try {
          mostrarNotificacion('🔐 Función de edición de roles disponible en próximas versiones', 'info');
        } catch (error) {
          console.error('❌ Error editando roles:', error);
        }
      }

      // Función para cambiar colores
      function cambiarColorPrimario(color) {
        try {
          document.documentElement.style.setProperty('--axyra-primary', color);
          console.log('🎨 Color primario cambiado a:', color);
        } catch (error) {
          console.error('❌ Error cambiando color primario:', error);
        }
      }

      function cambiarColorSecundario(color) {
        try {
          document.documentElement.style.setProperty('--axyra-secondary', color);
          console.log('🎨 Color secundario cambiado a:', color);
        } catch (error) {
          console.error('❌ Error cambiando color secundario:', error);
        }
      }

      function cambiarColorAcento(color) {
        try {
          document.documentElement.style.setProperty('--axyra-accent', color);
          console.log('🎨 Color de acento cambiado a:', color);
        } catch (error) {
          console.error('❌ Error cambiando color de acento:', error);
        }
      }

      // Función para configurar 2FA
      function setup2FA() {
        try {
          if (window.axyra2FA && window.axyra2FA.setup) {
            window.axyra2FA.setup();
          } else {
            mostrarNotificacion('🔐 Sistema 2FA no disponible en este momento', 'warning');
          }
        } catch (error) {
          console.error('❌ Error configurando 2FA:', error);
          mostrarNotificacion('❌ Error configurando 2FA: ' + error.message, 'error');
        }
      }

      // Función para probar 2FA
      function test2FA() {
        try {
          if (window.axyra2FA && window.axyra2FA.test) {
            window.axyra2FA.test();
          } else {
            mostrarNotificacion('🔐 Sistema 2FA no disponible para pruebas', 'warning');
          }
        } catch (error) {
          console.error('❌ Error probando 2FA:', error);
          mostrarNotificacion('❌ Error probando 2FA: ' + error.message, 'error');
        }
      }

      // Función para renovar sesión
      function resetSessionTimeout() {
        try {
          if (window.axyraSessionTimeout) {
            window.axyraSessionTimeout.reset();
            mostrarNotificacion('⏰ Sesión renovada correctamente', 'success');
          } else {
            mostrarNotificacion('⏰ Sistema de timeout no disponible', 'warning');
          }
        } catch (error) {
          console.error('❌ Error renovando sesión:', error);
        }
      }

      // Función para configurar timeout de sesión
      function configureSessionTimeout() {
        try {
          const timeout = prompt('Ingresa el nuevo timeout en minutos (15-120):', '30');
          if (timeout && !isNaN(timeout) && timeout >= 15 && timeout <= 120) {
            if (window.axyraSessionTimeout) {
              window.axyraSessionTimeout.setTimeout(timeout * 60 * 1000);
              mostrarNotificacion(`⏰ Timeout configurado a ${timeout} minutos`, 'success');
            } else {
              mostrarNotificacion('⏰ Sistema de timeout no disponible', 'warning');
            }
          }
        } catch (error) {
          console.error('❌ Error configurando timeout:', error);
        }
      }

      // Función para probar responsive
      function testResponsive() {
        try {
          const viewports = [
            { name: 'Móvil', width: 375, height: 667 },
            { name: 'Tablet', width: 768, height: 1024 },
            { name: 'Desktop', width: 1920, height: 1080 }
          ];
          
          const viewport = viewports[Math.floor(Math.random() * viewports.length)];
          mostrarNotificacion(`📱 Probando: ${viewport.name} (${viewport.width}x${viewport.height})`, 'info');
        } catch (error) {
          console.error('❌ Error probando responsive:', error);
        }
      }

      // Función para configurar responsive
      function configureResponsive() {
        try {
          mostrarNotificacion('📱 Configuración de responsive disponible en próximas versiones', 'info');
        } catch (error) {
          console.error('❌ Error configurando responsive:', error);
        }
      }

      // Función para configurar backup
      function configureBackup() {
        try {
          const frecuencia = prompt('Ingresa la frecuencia de respaldo (daily/weekly/monthly):', 'daily');
          if (frecuencia && ['daily', 'weekly', 'monthly'].includes(frecuencia)) {
            mostrarNotificacion(`💾 Frecuencia de backup configurada a: ${frecuencia}`, 'success');
          }
        } catch (error) {
          console.error('❌ Error configurando backup:', error);
        }
      }

      // Función para probar notificaciones
      function testNotifications() {
        try {
          mostrarNotificacion('🔔 Notificación de prueba funcionando correctamente', 'success');
        } catch (error) {
          console.error('❌ Error probando notificaciones:', error);
        }
      }

      // Función para configurar notificaciones
      function configureNotifications() {
        try {
          const frecuencia = prompt('Ingresa la frecuencia de notificaciones en minutos (5-60):', '10');
          if (frecuencia && !isNaN(frecuencia) && frecuencia >= 5 && frecuencia <= 60) {
            mostrarNotificacion(`🔔 Frecuencia configurada a: cada ${frecuencia} minutos`, 'success');
          }
        } catch (error) {
          console.error('❌ Error configurando notificaciones:', error);
        }
      }

      // Función para verificar actualizaciones
      function checkUpdates() {
        try {
          mostrarNotificacion('🔄 Verificando actualizaciones...', 'info');
          setTimeout(() => {
            mostrarNotificacion('✅ Sistema actualizado a la última versión', 'success');
          }, 2000);
        } catch (error) {
          console.error('❌ Error verificando actualizaciones:', error);
        }
      }

      // Función para configurar actualizaciones
      function configureUpdates() {
        try {
          mostrarNotificacion('🔄 Configuración de actualizaciones disponible en próximas versiones', 'info');
        } catch (error) {
          console.error('❌ Error configurando actualizaciones:', error);
        }
      }

      // Función para realizar respaldo
      function performBackup() {
        try {
          createBackup();
        } catch (error) {
          console.error('❌ Error realizando respaldo:', error);
        }
      }

      // Función para guardar configuración de empresa
      function saveCompanyConfig() {
        try {
          const config = {
            nombre: document.getElementById('companyName')?.value || '',
            nit: document.getElementById('companyNIT')?.value || '',
            direccion: document.getElementById('companyAddress')?.value || '',
            telefono: document.getElementById('companyPhone')?.value || '',
            email: document.getElementById('companyEmail')?.value || ''
          };

          localStorage.setItem('axyra_empresa_config', JSON.stringify(config));
          mostrarNotificacion('✅ Configuración de empresa guardada correctamente', 'success');
        } catch (error) {
          console.error('❌ Error guardando configuración:', error);
          mostrarNotificacion('❌ Error guardando configuración: ' + error.message, 'error');
        }
      }

      // Función para restaurar configuración de empresa
      function resetCompanyConfig() {
        try {
          const configuracion = JSON.parse(localStorage.getItem('axyra_configuracion_completa') || '{}');
          if (configuracion.empresa) {
            Object.entries(configuracion.empresa).forEach(([key, value]) => {
              const element = document.getElementById(key === 'nombre' ? 'companyName' : 
                                                   key === 'nit' ? 'companyNIT' : 
                                                   key === 'direccion' ? 'companyAddress' : 
                                                   key === 'telefono' ? 'companyPhone' : 
                                                   key === 'email' ? 'companyEmail' : null);
              if (element) {
                element.value = value;
              }
            });
            mostrarNotificacion('✅ Configuración restaurada a valores por defecto', 'success');
          }
        } catch (error) {
          console.error('❌ Error restaurando configuración:', error);
        }
      }

      // Agregar todas las funciones al scope global
      window.createBackup = createBackup;
      window.agregarNuevoUsuario = agregarNuevoUsuario;
      window.editarRoles = editarRoles;
      window.cambiarColorPrimario = cambiarColorPrimario;
      window.cambiarColorSecundario = cambiarColorSecundario;
      window.cambiarColorAcento = cambiarColorAcento;
      window.setup2FA = setup2FA;
      window.test2FA = test2FA;
      window.resetSessionTimeout = resetSessionTimeout;
      window.configureSessionTimeout = configureSessionTimeout;
      window.testResponsive = testResponsive;
      window.configureResponsive = configureResponsive;
      window.configureBackup = configureBackup;
      window.testNotifications = testNotifications;
      window.configureNotifications = configureNotifications;
      window.checkUpdates = checkUpdates;
      window.configureUpdates = configureUpdates;
      window.performBackup = performBackup;
      window.saveCompanyConfig = saveCompanyConfig;
      window.resetCompanyConfig = resetCompanyConfig;
    </script>
  </body>
</html>
