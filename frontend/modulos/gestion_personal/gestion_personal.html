<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AXYRA - Gestión de Personal</title>

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- Estilos AXYRA -->
    <link rel="stylesheet" href="../../static/axyra-styles.css" />
    <link rel="stylesheet" href="../../static/responsive-styles.css" />
    <link rel="stylesheet" href="../../static/modal-fixes.css" />
    <link rel="stylesheet" href="gestion_personal.css" />

    <!-- Header Compartido AXYRA -->
    <script src="../../static/include-header.js"></script>
  </head>
  <body>
    <!-- Header Compartido AXYRA - Se insertará automáticamente -->

    <!-- Sistema de Notificaciones Profesionales -->
    <div id="notificacionesSistema" class="notificaciones-sistema">
      <div id="notificacion" class="notificacion">
        <div class="notificacion-icono">
          <i id="notificacionIcono" class="fas fa-info-circle"></i>
        </div>
        <div class="notificacion-contenido">
          <h4 id="notificacionTitulo">Notificación</h4>
          <p id="notificacionMensaje">Mensaje de la notificación</p>
        </div>
        <button class="notificacion-cerrar" onclick="cerrarNotificacion()">
          <i class="fas fa-times"></i>
        </button>
      </div>
    </div>

    <!-- Contenido Principal -->
    <div class="gestion-container">
      <!-- Header del Módulo -->
      <div class="modulo-header">
        <h1 class="modulo-title">
          <i class="fas fa-users-cog"></i>
          Gestión de Personal
        </h1>
        <p class="modulo-subtitle">Administra empleados, roles y permisos del sistema</p>
        <div class="modulo-actions">
          <button class="btn btn-primary" onclick="abrirModalEmpleado()">
            <i class="fas fa-user-plus"></i> Nuevo Empleado
          </button>
          <button class="btn btn-secondary" onclick="abrirModalRol()"><i class="fas fa-user-tag"></i> Nuevo Rol</button>
          <button class="btn btn-info" onclick="exportarPersonal()"><i class="fas fa-download"></i> Exportar</button>
        </div>
      </div>

      <!-- Filtros y Búsqueda -->
      <div class="filtros-section">
        <div class="filtros-grid">
          <div class="filtro-grupo">
            <label for="filtroDepartamento">Departamento:</label>
            <select id="filtroDepartamento" onchange="aplicarFiltros()">
              <option value="">Todos los departamentos</option>
              <option value="Administración">Administración</option>
              <option value="Ventas">Ventas</option>
              <option value="Producción">Producción</option>
              <option value="Recursos Humanos">Recursos Humanos</option>
              <option value="Tecnología">Tecnología</option>
            </select>
          </div>

          <div class="filtro-grupo">
            <label for="filtroEstado">Estado:</label>
            <select id="filtroEstado" onchange="aplicarFiltros()">
              <option value="">Todos los estados</option>
              <option value="activo">Activo</option>
              <option value="inactivo">Inactivo</option>
              <option value="vacaciones">Vacaciones</option>
              <option value="licencia">Licencia</option>
            </select>
          </div>

          <div class="filtro-grupo">
            <label for="filtroRol">Rol:</label>
            <select id="filtroRol" onchange="aplicarFiltros()">
              <option value="">Todos los roles</option>
              <option value="admin">Administrador</option>
              <option value="gerente">Gerente</option>
              <option value="supervisor">Supervisor</option>
              <option value="empleado">Empleado</option>
            </select>
          </div>

          <div class="filtro-grupo">
            <label for="busquedaPersonal">Buscar:</label>
            <div class="busqueda-input">
              <input
                type="text"
                id="busquedaPersonal"
                placeholder="Nombre, cédula o email..."
                onkeyup="aplicarFiltros()"
              />
              <i class="fas fa-search"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Tabla de Personal -->
      <div class="tabla-section">
        <div class="tabla-header">
          <h3><i class="fas fa-table"></i> Lista de Personal</h3>
          <div class="tabla-actions">
            <span class="contador-registros" id="contadorRegistros">0 registros</span>
            <button class="btn btn-sm btn-outline" onclick="limpiarFiltros()">
              <i class="fas fa-undo"></i> Limpiar
            </button>
          </div>
        </div>

        <div class="tabla-container">
          <table class="tabla-personal" id="tablaPersonal">
            <thead>
              <tr>
                <th>Foto</th>
                <th>Nombre</th>
                <th>Cédula</th>
                <th>Departamento</th>
                <th>Rol</th>
                <th>Estado</th>
                <th>Salario</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody id="tablaPersonalBody">
              <!-- Los datos se cargarán dinámicamente -->
            </tbody>
          </table>
        </div>

        <!-- Paginación -->
        <div class="paginacion" id="paginacion">
          <!-- La paginación se generará dinámicamente -->
        </div>
      </div>

      <!-- Estadísticas del Personal -->
      <div class="estadisticas-section">
        <h3><i class="fas fa-chart-pie"></i> Estadísticas del Personal</h3>
        <div class="estadisticas-grid">
          <div class="estadistica-card">
            <div class="estadistica-icono">
              <i class="fas fa-users"></i>
            </div>
            <div class="estadistica-contenido">
              <h4 id="totalPersonal">0</h4>
              <p>Total Personal</p>
            </div>
          </div>

          <div class="estadistica-card">
            <div class="estadistica-icono">
              <i class="fas fa-user-check"></i>
            </div>
            <div class="estadistica-contenido">
              <h4 id="personalActivo">0</h4>
              <p>Personal Activo</p>
            </div>
          </div>

          <div class="estadistica-card">
            <div class="estadistica-icono">
              <i class="fas fa-building"></i>
            </div>
            <div class="estadistica-contenido">
              <h4 id="totalDepartamentos">0</h4>
              <p>Departamentos</p>
            </div>
          </div>

          <div class="estadistica-card">
            <div class="estadistica-icono">
              <i class="fas fa-dollar-sign"></i>
            </div>
            <div class="estadistica-contenido">
              <h4 id="promedioSalario">$0</h4>
              <p>Promedio Salario</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal Nuevo/Editar Empleado -->
    <div id="modalEmpleado" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalEmpleadoTitulo">Nuevo Empleado</h3>
          <button class="modal-close" onclick="cerrarModalEmpleado()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="formEmpleado" onsubmit="guardarEmpleado(event)">
            <div class="form-grid">
              <div class="form-grupo">
                <label for="empleadoNombre">Nombre Completo *</label>
                <input type="text" id="empleadoNombre" required />
              </div>

              <div class="form-grupo">
                <label for="empleadoCedula">Cédula *</label>
                <input type="text" id="empleadoCedula" required />
              </div>

              <div class="form-grupo">
                <label for="empleadoEmail">Email *</label>
                <input type="email" id="empleadoEmail" required />
              </div>

              <div class="form-grupo">
                <label for="empleadoTelefono">Teléfono</label>
                <input type="tel" id="empleadoTelefono" />
              </div>

              <div class="form-grupo">
                <label for="empleadoDepartamento">Departamento *</label>
                <select id="empleadoDepartamento" required>
                  <option value="">Seleccionar departamento</option>
                  <option value="Administración">Administración</option>
                  <option value="Ventas">Ventas</option>
                  <option value="Producción">Producción</option>
                  <option value="Recursos Humanos">Recursos Humanos</option>
                  <option value="Tecnología">Tecnología</option>
                </select>
              </div>

              <div class="form-grupo">
                <label for="empleadoRol">Rol *</label>
                <select id="empleadoRol" required>
                  <option value="">Seleccionar rol</option>
                  <option value="admin">Administrador</option>
                  <option value="gerente">Gerente</option>
                  <option value="supervisor">Supervisor</option>
                  <option value="empleado">Empleado</option>
                </select>
              </div>

              <div class="form-grupo">
                <label for="empleadoSalario">Salario Base *</label>
                <input type="number" id="empleadoSalario" min="0" step="1000" required />
              </div>

              <div class="form-grupo">
                <label for="empleadoEstado">Estado *</label>
                <select id="empleadoEstado" required>
                  <option value="activo">Activo</option>
                  <option value="inactivo">Inactivo</option>
                  <option value="vacaciones">Vacaciones</option>
                  <option value="licencia">Licencia</option>
                </select>
              </div>

              <div class="form-grupo full-width">
                <label for="empleadoDireccion">Dirección</label>
                <textarea id="empleadoDireccion" rows="3"></textarea>
              </div>

              <div class="form-grupo full-width">
                <label for="empleadoObservaciones">Observaciones</label>
                <textarea id="empleadoObservaciones" rows="3"></textarea>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="cerrarModalEmpleado()">Cancelar</button>
              <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal Nuevo Rol -->
    <div id="modalRol" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Nuevo Rol</h3>
          <button class="modal-close" onclick="cerrarModalRol()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="formRol" onsubmit="guardarRol(event)">
            <div class="form-grupo">
              <label for="rolNombre">Nombre del Rol *</label>
              <input type="text" id="rolNombre" required />
            </div>

            <div class="form-grupo">
              <label for="rolDescripcion">Descripción</label>
              <textarea id="rolDescripcion" rows="3"></textarea>
            </div>

            <div class="form-grupo">
              <label for="rolPermisos">Permisos</label>
              <div class="permisos-grid">
                <label class="permiso-checkbox">
                  <input type="checkbox" value="dashboard:read" />
                  <span>Ver Dashboard</span>
                </label>
                <label class="permiso-checkbox">
                  <input type="checkbox" value="empleados:read" />
                  <span>Ver Empleados</span>
                </label>
                <label class="permiso-checkbox">
                  <input type="checkbox" value="empleados:write" />
                  <span>Editar Empleados</span>
                </label>
                <label class="permiso-checkbox">
                  <input type="checkbox" value="nomina:read" />
                  <span>Ver Nómina</span>
                </label>
                <label class="permiso-checkbox">
                  <input type="checkbox" value="nomina:write" />
                  <span>Editar Nómina</span>
                </label>
                <label class="permiso-checkbox">
                  <input type="checkbox" value="config:read" />
                  <span>Ver Configuración</span>
                </label>
                <label class="permiso-checkbox">
                  <input type="checkbox" value="config:write" />
                  <span>Editar Configuración</span>
                </label>
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="cerrarModalRol()">Cancelar</button>
              <button type="submit" class="btn btn-primary"><i class="fas fa-save"></i> Guardar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Scripts -->
    <!-- Firebase -->
    <script>
      // Configuración de Firebase
      const firebaseConfig = {
        apiKey: 'AIzaSyBXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX',
        authDomain: 'axyra-app.firebaseapp.com',
        projectId: 'axyra-app',
        storageBucket: 'axyra-app.appspot.com',
        messagingSenderId: '123456789012',
        appId: '1:123456789012:web:abcdefghijklmnop',
      };

      // Inicializar Firebase
      if (typeof firebase !== 'undefined') {
        firebase.initializeApp(firebaseConfig);
        console.log('🔥 Firebase inicializado correctamente');
      } else {
        console.warn('⚠️ Firebase no está disponible');
      }
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-auth-compat.js"></script>

    <!-- Scripts de la aplicación -->
    <script src="../../static/axyra-integration.js"></script>
    <script src="../../static/unified-auth-system.js"></script>
    <script src="gestion_personal.js"></script>
  </body>
</html>
